<!DOCTYPE html>
<html>

<head>
    <title>C50 Index</title>
    <style>
        .tr {text-align: right;}
        .tl {text-align: left;}
        .tc {text-align: center;}
        .dib {display: inline-block;}
        .w-100 {width: 100%;}
        .w-40 {width: 40%;}
        .w-30 {width: 30%;}
        .container {
            padding-right: 15px;
            padding-left: 15px;
            margin-right: auto;
            margin-left: auto;
        }
        @media (min-width: 768px) {
            .container {
                width: 750px;
            }
        }
        @media (min-width: 992px) {
            .container {
                width: 970px;
            }
        }
        @media (min-width: 1200px) {
            .container {
                width: 1170px;
            }
        }
    </style>
</head>

<body>
    <script>
        function get(url, success) {
            var request = new XMLHttpRequest();
            request.open('GET', url, true);
            request.onload = function() {
                if (request.status >= 200 && request.status < 400) {
                    var resp = request.responseText;
                    success(JSON.parse(resp));
                }
            };
            request.send();
        }

        function h(nodeName, attributes, ...args) {
            let children = args.length ? [].concat(...args) : null;
            return {
                nodeName,
                attributes,
                children
            };
        }

        function render(vnode) {
            if (vnode.split) return document.createTextNode(vnode);
            let n = document.createElement(vnode.nodeName);
            let as = vnode.attributes || {};
            for (let k in as) n.setAttribute(k, as[k]);
            (vnode.children || []).map(c => n.appendChild(render(c)));
            return n;
        }

        let CoinsTable = function(data) {
            let Coins = coins => coins.map((coin,i) => {
                let coinInfo = coin['CoinInfo'];
                let conversionInfo = coin['ConversionInfo'];
                let raw = conversionInfo['RAW'][0].split('~');
                let price = raw[5];
                let supply = conversionInfo['Supply'];
                let marketCap = (price * supply).toLocaleString() + ' ' + coinInfo['Name'];

                return (h('tr', {},
                    h('td', {class: 'tc'}, "" + (i + 1)),
                    h('td', {class: 'tl'},
                    h('td', {class: 'dib'},
                        h('img', {
                            class: '',
                            src: `https://www.cryptocompare.com${coinInfo['ImageUrl']}`,
                            width: '25px',
                            height: '25px'
                        }),
                        coinInfo['FullName'])
                        ),
                    h('td', {class: 'tr'}, supply ? marketCap :  '_'),
                    h('td', {class: 'tr'}, '$' + price),
                    h('td', {class: 'tr'}, supply ? supply.toLocaleString() : '_'),
                ));
            });

            return (
                h('table', {}, 
                    h('th', {class: 'tc'}, '#'),
                    h('th', {class: 'tl'}, 'Name'),
                    h('th', {class: 'tr'}, 'Market Cap'),
                    h('th', {class: 'tr'}, 'Price'),
                    h('th', {class: 'tr'}, 'Circulating Supply'),
                    Coins(data),
                    ));
        }


        function drawScreen(response) {
            let children = (
                render(h('div', {class: 'container tc'},
                    CoinsTable(response["Data"])))
            );
            let app = document.getElementById('coinsTable');
            if(app.firstChild) app.removeChild(app.firstChild);
            app.appendChild(children);
        }



        var tid = setInterval(function() {
            if (document.readyState !== 'complete') return;
            clearInterval(tid);
            get("https://min-api.cryptocompare.com/data/top/totalvol?limit=52&tsym=USD", drawScreen);
            setInterval(function() {
                get("https://min-api.cryptocompare.com/data/top/totalvol?limit=52&tsym=USD", drawScreen)
            }, 3000);
        }, 100);
    </script>

    <div class='container'>
        <div class='w-100'>
            <div class="w-100 dib tl">
                <img class='tc' width='50px' src='https://camo.githubusercontent.com/fddfe95308fb6a93060ac1526883c8fedde4b450/687474703a2f2f7777772e633530696e6465782e636f6d2f77702d636f6e74656e742f75706c6f6164732f323031382f30352f6335302d66696e616c6c6f676f3262312d312d65313532363232323731313737392d323036783330302e706e67' />
            </div>
            <div div='dib w-30'>
                <span><h2 class='dib'>C50 Tracker </h2>   50 Cryptos in 1</span>
            </div>
        </div> 
    <div id='coinsTable'></div>
    </div>
</body>

</html>